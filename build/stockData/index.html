<html>

<body>
    <h1 id="heading"></h1>
    <div id="CharContainer"></div>
    <div class="tooltip"></div>

    <head>
        <script src="https://d3js.org/d3.v4.js"></script>
        <script src="d3Chart.js"></script>
        <link rel="stylesheet" type="text/css" href="stock.css">

        <div id="StockSelect"></div>
        <button class="resetButton"> Reset</button>
    </head>
    <script>

        // Populate Drown Down from Fully Trained Model
        d3.csv('fullTrained.csv', function (d) {
            return {
                'symbol': d.Symbol,
                'company': d.Company,
                'loss': d.loss,
                'epochs': d.Epochs,
                'duration': d.Duration
            };
        }, function (error, data) {

            data = data.filter((thing, index, self) =>
                index === self.findIndex((t) => (
                    t.symbol === thing.symbol
                ))
            );
            data.push({
                'symbol': 'DontSelect',
                'company': '---'
            });
            d3.select("#StockSelect")
                .append("select")
                .on('change', function () {
                    var o = this.options[this.selectedIndex];
                    if (o.value === 'DontSelect') {
                        return;
                    }
                    d3.select('h1')
                        .text(o.text);
                    var url = "http://localhost:4242/stockData/" + o.value;
                    fetch(url)
                        .then(response => response.text())
                        .then(contents => {
                            updateGraph(o.value, o.text);
                        })
                        .catch(() => console.log("Canâ€™t access " + url + " Blocked by browser?"))

                })
                .selectAll("option").data(data)
                .enter().append("option")
                .text(function (d) {
                    return d.company;
                })
                .attr("value", function (d) {
                    return d.symbol;
                });

            // Initial Value
            d3.select('select').property('value', 'DontSelect');
        });

        function updateGraph(stockSymbol, company) {
            d3.select('h1')
                .text(company);
            clearGraph();
            plotStockPrice(stockSymbol + '_test.csv');
            plotStockPrice(stockSymbol + '_test_pred.csv', true);
        }
    </script>
</body>

</html>